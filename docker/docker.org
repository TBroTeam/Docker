* Installation for TBro using Docker containers

** General structure
   The Docker installation is separated into two independent containers:
   1) Database container
      - postgresql
      - CHADO database scheme plus modifications
      - AdminTools
   2) TBro Website
      - Apache2
      - php settings...
   3) memcached container
      Maybe better included into TBro website container
   4) Worker container

** Preparation
   #+BEGIN_SRC sh
     mkdir db_container
     mkdir apache_container
     mkdir memcached_container
     mkdir worker_container
   #+END_SRC

   According to the thesis of Lenz, it is required to install Chado
   1.2 separately. Therefore I need to download the Chado file first.
   #+BEGIN_SRC sh :dir db_container/
     wget -O chado-1.2.tar.gz 'http://downloads.sourceforge.net/project/gmod/gmod/chado-1.2/chado-1.2.tar.gz?r=http%3A%2F%2Fsourceforge.net%2Fprojects%2Fgmod%2Ffiles%2Fgmod%2Fchado-1.2%2F&ts=1415403627&use_mirror=kent'
   #+END_SRC

   Following the installation instructions from Lenz thesis, the next
   step is the reduction of the database scheme:
   #+BEGIN_SRC sh :dir db_container/
     # untar the chado archive
     tar xzf chado-1.2.tar.gz

     # change to newly created folder
     cd chado-1.2

     # follow the instructions of Lenz:
     cd modules
     perl bin/makedep.pl --modules general,cv,pub,organism,sequence,contact,companalysis,mage > default_schema.sql
     cd ../..

     # create a new archive used for later transfer to image
     tar czf chado-1.2.mod.tar.gz chado-1.2
   #+END_SRC

   Additionally, I have to download the obo file for GO terms and convert it into XML
   #+BEGIN_SRC sh :dir db_container/
     wget -O gene_ontology.1_2.obo 'http://www.geneontology.org/ontology/obo_format_1_2/gene_ontology.1_2.obo'
     # TODO
   #+END_SRC

** Database container
   We start from the default postgres container
   #+BEGIN_SRC sh :tangle db_container/Dockerfile
     FROM postgres:9.3
   #+END_SRC

   First we update our machine and install the required php packages
   #+BEGIN_SRC sh :tangle db_container/Dockerfile
     RUN apt-get update
     RUN apt-get --assume-yes install \
         php5-cli \
         php-pear \
         php5-pgsql \
         php5-curl \
         php5-dev \
         build-essential
   #+END_SRC

   Next we need to install phing
   #+BEGIN_SRC sh :tangle db_container/Dockerfile
     RUN pear channel-discover pear.phing.info
     RUN pear install --alldeps phing/phing
   #+END_SRC

   Modify php.ini to diable phar.readonly
   #+BEGIN_SRC sh :tangle db_container/Dockerfile
     RUN sed -i '/phar.readonly = /s/^.*/phar.readonly = Off/' /etc/php5/cli/php.ini
   #+END_SRC
